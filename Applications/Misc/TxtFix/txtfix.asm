; This program is designed to be loaded into memory, and catch stray jumps; When a jump is caught, it will be reported to the operator; Equatesbdos	equ	0x0005fcb	equ	0x005Cdirent	equ	0x0080b_coin	equ	0x01b_cout	equ	0x02b_print	equ	0x09b_open	equ	0x0Fb_close	equ	0x10b_sfirs	equ	0x11b_snext	equ	0x12b_read	equ	0x14b_write	equ	0x15b_make	equ	0x16b_dma	equ	0x1Ab_rrnd	equ	0x21b_wrnd	equ	0x22b_size	equ	0x23f_rand	equ	0x21; Program start	org	0x0100	start:	ld	c,b_print	ld	de,splash	call	bdos		; Dump out all matching filenames into the heap	ld	c,b_dma	ld	de,dirent	call	bdos		ld	c,b_sfirs	ld	de,fcb	call	bdos		; If done, be donenextf:	ld	b,0xFF	cp	b	jr	z,endlook		; Calculate address of directory entry	ld	hl,dirent	ld	de,32gethl:	or	a	jr	z,gothl	dec	a	add	hl,de	jr	gethl	; Now copy it to heapgothl:	inc	hl	ld	de,(pointer)	ld	bc,11	ldir	ld	(pointer),de		; Find next filename	ld	c,b_snext	ld	de,fcb	call	bdos	jr	nextf		; Zero terminate arrayendlook:ld	de,(pointer)	xor	a	ld	(de),a	ld	hl,heap		; Scan through file list, and fix themscanf:	ld	(pointer),hl	xor	a	cp	(hl)	ret	z	call	dofix	ld	hl,(pointer)	ld	de,11	add	hl,de	jr	scanf	 	ret	; Performs actual fix operation; hl = Address of filename to fix;; uses: alldofix:	ld	de,fcb	xor	a	ld	(de),a		; Copy filename	inc	de	ld	bc,11	ldir		; Clear rest of FCB	ld	(de),a	ld	h,d	ld	l,e	inc	de	ld	bc,23	ldir		; Open file	ld	c,b_open	ld	de,fcb	call	bdos		; Calculate file size	ld	c,b_size	ld	de,fcb	call	bdos		; Get last block (make sure it's not zero)	ld	hl,(fcb+f_rand)	ld	a,l	or	h	ret	z	dec	hl	ld	(fcb+f_rand),hl		; Read in block	ld	c,b_dma	ld	de,buffer	call	bdos	ld	c,b_rrnd	ld	de,fcb	call	bdos		; "Fix" the file	ld	b,128	ld	hl,buffer+128	dofix0:	dec	hl	ld	a,(hl)	or	a	jr	nz,dofix1	ld	a,0x1A	ld	(hl),a	djnz	dofix0		; Fixing done, write it backdofix1:	ld	c,b_wrnd	ld	de,fcb	call	bdos		; And close it!	ld	c,b_close	ld	de,fcb	jp	bdossplash:		defb	'ISHKUR/NFS TextFix Utiltiy$'buffer:	defs	128pointer:	defw	heapheap: